# Тест план, для проверки функциональности бота
Ниже представлен список функциональности, который должен реализовывать бот, а так же последовательный план её тестирования
## Термины
- Обратная связь, фидбек, ОС - сообщение, оставленное в рамках одного группового чата для определённого участника этого чата
## Список функциональности
- Личные сообщения с ботом
  - Обработка команд
    - На команду `/start` отправляет приветственное сообщение
    - На команду `/get` отправляет новые сообщения обратной связи для этого пользователя
    - На команду `/get_all` отправляет все не удалённые сообщения обратной связи для этого пользователя
    - На команду `/clear` удаляет все сообщения для этого пользователя (становятся недоступны для команд `/get` и `/get_all`)
    - ⚠️**WIP:** На команду `/butter` отправляет сообщение со справкой по принципу обратной связи "бутерброд"
    - ⚠️**WIP:** На команду `/sandwich` отправляет сообщение со справкой по принципу обратной связи "сендвич"
  - Получение списка пользователей из чата, в котором была нажата кнопка отправки обратной связи
  - Нажатие кнопок
    - Кнопка "Отменить" - возвращает чат с пользователем в исходное состояние ожидания
    - Кнопка с указанием пользователя для отправки обратной связи - присылает сообщение, приглашающее написать сообщение обратной связи и переводит чат с пользователем в режим ожидания ввода сообщения ОС
    - Сообщение подтверждения обратной связи
      - Кнопка "Анонимно" - записывает в БД сообщение ОС без указания отправителя
      - Кнопка "От моего лица" - записывает в БД сообщение ОС с указанием отправяителя
      - Кнопка "Переписать" - очищает введённую ОС, присылает сообщение, приглашающее написать новое сообщение обратной связи и переводит чат с пользователем в режим ожидания ввода сообщения ОС
- Групповой чат
  - При добавлении в чат отправляет приветственное сообщение с подготовленной командой `/feedback` и кнопкой "Хочу получать ОС!"
  - В соответствии с настроеным режимом напоминания отправлять сообщение-напоминание:
    - раз в день
    - раз в неделю
    - раз в две недели
  - Обработка команд
    - На команду `/feedback` отправляет сообщение-напоминание об ОС в групповой чат
  - Нажатие кнопок
    - Приветственное сообщение
      - Кнопка "Хочу получать ОС!" - регистрирует связь пользователя и этого чата в БД, чтобы ему можно было оставить обратную связь
    - Сообщение-напоминание об ОС
      - Кнопка "Хочу получать ОС!" - регистрирует связь пользователя и этого чата в БД, чтобы ему можно было оставить обратную связь
      - Кнопка "Отправить обратную связь" - отправляет в личные сообщения список зарегистрированных для этого чата пользователей в виде кнопок (см. функциональность личных сообщений с ботом)
      - Кнопка "Напоминать ежедневно" - настраивает режим напоминаний для отправки сообщения напоминания каждый день 
      - Кнопка "Напоминать еженедельно" - настраивает режим напоминаний для отправки сообщения напоминания раз в неделю
      - Кнопка "Раз в 2 недели" - настраивает режим напоминаний для отправки сообщения напоминания раз в 2 недели
      - Кнопка "Отключить напоминания" - отключает режим напоминаний для этого группового чата
      - Кнопка "Перейти в сообщения с ботом" - открывает личные сообщения с ботом

## Тестирование
Для тестирования нужно обеспечить следующие условия:
1. Должен быть создан тестовый групповой чат
2. Бот не должен быть участником тестового чата
3. БД бота должна быть очищена
4. Для удобства - можно очистить историю личных сообщений с ботом

Шаги тестирования
<table>
    <tr>
        <th>№ п.п.</th>
        <th>Действие</th>
        <th>Ожидаемый результат</th>
    </tr>
    <tr>
        <td colspan="3"><b>1. Начало личных сообщений с ботом</b></td>
    </tr>
    <tr>
        <td>1.1</td>
        <td>Начать личные сообщения с ботом командой `/start`</td>
        <td>Бот отправит приветственное сообщение с командами</td>
    </tr>
    <tr>
        <td>1.2</td>
        <td>Ввести команду /get</td>
        <td>Бот отправит сообщение, что новой ОС нет</td>
    </tr>
    <tr>
        <td>1.3</td>
        <td>Ввести команду /get_all</td>
        <td>Бот отправит сообщение, что ОС нет</td>
    </tr>
    <tr>
        <td>1.4</td>
        <td>Ввести команду /clear</td>
        <td>Бот отправит сообщение, что ОС очищена</td>
    </tr>
    <tr>
        <td colspan="3"><i>*примечание - команды /butter и /sandwich не реализованы. Отсутствие ответа на эти команды - ожидаемый результат</i></td>
    </tr>
    <tr>
        <td colspan="3"><b>2. Работа с ботом в групповом чате</b></td>
    </tr>
    <tr>
        <td>2.1</td>
        <td>Добавить бота в груповой чат</td>
        <td>Бот отправит приветственное сообщение в групповой чат с подготовленной командой /feedback и кнопкой "Хочу получать ОС!"</td>
    </tr>
    <tr>
        <td>2.2</td>
        <td>Отправить команду /feedback</td>
        <td>Бот отправит сообщение-напоминание с пустым списоком пользователей, доступных для ОС и кнопками:<br>
        - "Хочу получать ОС!"<br>
        - "Отправить обратную связь"<br>
        - "Напоминать ежедневно"<br>
        - "Напоминать еженедельно"<br>
        - "Раз в две недели"<br>
        - "Отключить напоминания"<br>
        - "Перейти к сообщениям с ботом"</td>
    </tr>
    <tr>
        <td>2.3</td>
        <td>Нажать кнопку "Хочу получать ОС!" (в любом сообщении)</td>
        <td>Бот отправит сообщение-подтверждение регистрации</td>
    </tr>
    <tr>
        <td>2.4</td>
        <td>Нажать кнопку "Отправить обратную связь"</td>
        <td>Бот отправит в личные сообщения, которое содержит набор кнопок, которые содержат список пользователей, которым можно оставить обратную связь (подробнее в разделе 3)</td>
    </tr>
    <tr>
        <td colspan="3"><b>2.5 Работа с напоминаниями</b><br>
        <i>Для тестирования этой функциональности без ожидания более одного дня необходимо 
        в файле bot.py найти функцию scheduled_actions() и вызов в ней db.get_chats и добавить в аргумент период таким образом - db.get_chats("minutes"). По умолчанию используется выборка, просматривающая количество дней (1/7/14), а это действие заменяет её на количество минут</i>
        </td>
    </tr>
    <tr>
        <td>2.5.1</td>
        <td>Нажать кнопку "Напоминать ежедневно"</td>
        <td>1. Бот отправит сообщение о том, что напоминание настроено<br>
        2. Раз в минуту бот будет отправлять сообщение-напоминание</td>
    </tr>
    <tr>
        <td>2.5.2</td>
        <td>Нажать кнопку "Напоминать еженедельно"</td>
        <td>1. Бот отправит сообщение о том, что напоминание настроено<br>
        2. Раз в 7 минут бот будет отправлять сообщение-напоминание</td>
    </tr>
    <tr>
        <td>2.5.3</td>
        <td>Нажать кнопку "Раз в 2 недели"</td>
        <td>1. Бот отправит сообщение о том, что напоминание настроено<br>
        2. Раз в 14 минут бот будет отправлять сообщение-напоминание</td>
    </tr>
    <tr>
        <td>2.5.4</td>
        <td>Нажать кнопку "Отключить напоминания"</td>
        <td>1. Бот отправит сообщение о том, что напоминание отключено<br>
        2. В течение 14 минут и далее бот не отправит сообщений-напоминаний</td>
    </tr>
    <tr>
        <td>2.6</td>
        <td>Нажать кнопку "Перейти в сообщения с ботом"</td>
        <td>Открыты личные сообщения с ботом</td>
    </tr>
    <tr>
        <td colspan="3"><b>3. Работа с обратной связью в личных сообщениях</b><br>
        <i>Важно, чтобы перед началом этого раздела были выполнены пункты 2.4 и 2.6, т.е. открыты личные сообщения с ботом и получено сообщение со списком пользователей</i></td>
    </tr>
    <tr>
        <td>3.1</td>
        <td>Нажать на кнопку с именем пользователя</td>
        <td>Бот отправит сообщение-приглашение написать сообщение для обратной связи с кнопкой "Отменить"</td>
    </tr>
    <tr>
        <td>3.2</td>
        <td>Отправить сообщение в личные сообщения с ботом текст "текст 1"</td>
        <td>Бот отправит сообщение-подтверждение введённой обратной связи с кнопками:<br>
        - "Анонимно"<br>
        - "От моего лица"<br>
        - "Переписать"<br>
        - "Отменить"<br></td>
    </tr>
    <tr>
        <td>3.3</td>
        <td>Нажать кнопку "Переписать"</td>
        <td>Бот отправит сообщение-приглашение написать сообщение для обратной связи с кнопкой "Отменить"</td>
    </tr>
    <tr>
        <td>3.4</td>
        <td>Отправить сообщение в личные сообщения с ботом текст "текст 2"</td>
        <td>Бот отправит сообщение-подтверждение введённой обратной связи с кнопками:<br>
        - "Анонимно"<br>
        - "От моего лица"<br>
        - "Переписать"<br>
        - "Отменить"<br></td>
    </tr>
    <tr>
        <td>3.5</td>
        <td>Нажать кнопку "Анонимно"</td>
        <td>Бот отправит сообщение об успешной отправке обратной связи и списком пользователей, кому можно отправить обратную связь в виде кнопок</td>
    </tr>
    <tr>
        <td>3.6</td>
        <td>Нажать на кнопку с именем пользователя</td>
        <td>Бот отправит сообщение-приглашение написать сообщение для обратной связи с кнопкой "Отменить"</td>
    </tr>
    <tr>
        <td>3.7</td>
        <td>Отправить сообщение в личные сообщения с ботом текст "текст 3"</td>
        <td>Бот отправит сообщение-подтверждение введённой обратной связи с кнопками:<br>
        - "Анонимно"<br>
        - "От моего лица"<br>
        - "Переписать"<br>
        - "Отменить"<br></td>
    </tr>
    <tr>
        <td>3.5</td>
        <td>Нажать кнопку "От моего лица"</td>
        <td>Бот отправит сообщение об успешной отправке обратной связи и списком пользователей, кому можно отправить обратную связь в виде кнопок</td>
    </tr>
    <tr>
        <td>3.6</td>
        <td>Ввести команду /get</td>
        <td>Бот отправит сообщения:<br>
        - с обратной связью "текст 3" с указаннием автора<br>
        - с обратной связью "текст 2" с без указанния автора<br>
        - с окончанием списка обратной связи</td>
    </tr>
    <tr>
        <td>3.7</td>
        <td>Ввести команду /get</td>
        <td>Бот отправит сообщение о том, что список новых сообщений пуст</td>
    </tr>
    <tr>
        <td>3.8</td>
        <td>Ввести команду /get_all</td>
        <td>Бот отправит сообщения:<br>
        - с обратной связью "текст 3" с указаннием автора<br>
        - с обратной связью "текст 2" с без указанния автора<br>
        - с окончанием списка обратной связи</td>
    </tr>
    <tr>
        <td>3.9</td>
        <td>Ввести команду /clear</td>
        <td>Бот отправит сообщение о том, что список обратной связи очищен</td>
    </tr>
    <tr>
        <td>3.10</td>
        <td>Ввести команду /get_all</td>
        <td>Бот отправит сообщение о том, что список сообщений пуст</td>
    </tr>
</table>